################################################################################
# üîê NETWORKING / HOSTNAME (strict)
################################################################################
# Public URL (as seen by browsers); MUST match your reverse proxy public host.
hostname=https://auth.example.com
hostname-strict=true
hostname-strict-backchannel=false

# You are behind a TLS-terminating reverse proxy / LB:
proxy=edge
proxy-headers=xforwarded

# Proxy ‚Üí KC over HTTP on an internal network
http-enabled=true
http-host=0.0.0.0
http-port=8080

################################################################################
# üóÑÔ∏è DATABASE (PostgreSQL example; use TLS and a dedicated low-priv user)
################################################################################
db=mysql
db-url=${KC_DB_URL}
db-username=${KC_DB_USERNAME}
db-password=${KC_DB_PASSWORD}

# Right-size pool to your DB‚Äôs max_connections (sum across all nodes!)
# Keep min/initial/max equal for stable latency.
db-pool-initial-size=40
db-pool-min-size=40
db-pool-max-size=40

################################################################################
# üö¶ HTTP WORKERS / LOAD SHEDDING
################################################################################
# Cap threads per node to avoid CPU thrash; tune with metrics (CPU ~70% target).
http-pool-max-threads=64
# Prevent unbounded queues; return 503 under real overload (protects latency SLOs).
http-max-queued-requests=1000

################################################################################
# üìà OBSERVABILITY (separate mgmt port; restrict via firewall/NetPol)
################################################################################
metrics-enabled=true
health-enabled=true
http-management-port=9000
http-management-relative-path=/management

################################################################################
# üß† CACHES / CLUSTER (HA with encrypted inter-node traffic)
################################################################################
# If you run 2+ nodes, ship a tuned Infinispan XML and set owners=2 for resilience.
# Mount it at /opt/keycloak/conf/cache-ispn.xml and uncomment the next line:
#   cache-config-file=cache-ispn.xml

# Encrypt/authenticate JGroups gossip (mTLS between nodes):
cache-embedded-mtls-key-store-file=/opt/keycloak/conf/jgroups-keystore.p12
cache-embedded-mtls-key-store-password=${JGROUPS_KS_PASS}
cache-embedded-mtls-trust-store-file=/opt/keycloak/conf/jgroups-truststore.p12
cache-embedded-mtls-trust-store-password=${JGROUPS_TS_PASS}

################################################################################
# üåê OUTBOUND HTTP CLIENT (fast timeouts, pooled)
################################################################################
spi-connections-http-client--default--connection-pool-size=400
spi-connections-http-client--default--socket-timeout-millis=5000
spi-connections-http-client--default--establish-connection-timeout-millis=3000
spi-connections-http-client--default--max-connection-idle-time-millis=900000

################################################################################
# üîè TRUSTSTORE (if calling external IdPs/APIs with custom CAs)
################################################################################
#spi-truststore-file=/opt/keycloak/conf/truststore.p12
#spi-truststore-password=${TRUSTSTORE_PASS}
#spi-truststore-provider=file

################################################################################
# üß∞ MISC HARDENING
################################################################################
# Disable dev behaviors by NOT using "start-dev".
# Consider FIPS if mandated by policy (separate build/runtime).
