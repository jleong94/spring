# fly.toml app configuration file for PRODUCTION environment
# This file is used by the deploy-prod job in GitHub Actions workflow
# See https://fly.io/docs/reference/configuration/ for more details

app = 'spring'  # App name for production environment (must be unique on Fly.io)
primary_region = 'sin'  # Primary deployment region (Singapore)

[build]
  # Build configuration - uses Dockerfile in project root

[http_service]
  internal_port = 8080  # Port your Spring Boot app listens on inside the container
  force_https = true  # Automatically redirect HTTP to HTTPS
  auto_stop_machines = 'stop'  # Stop machines when there's no traffic (saves costs)
  auto_start_machines = true  # Automatically restart machines when traffic arrives
  min_machines_running = 0  # Minimum machines to keep running (0 = fully auto-scale)
  processes = ['app']  # Process group this service belongs to

[[vm]]
  memory = '1gb'  # Allocate 1GB RAM to the VM
  cpu_kind = 'shared'  # Use shared CPU (cost-effective option)
  cpus = 1  # Number of CPU cores

[env]
  SPRING_PROFILES_ACTIVE = "prod"  # Set Spring Boot profile to 'prod' (loads application-prod.yml)
